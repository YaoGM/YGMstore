---
title: 数据可视化-温州交通数据分析
typora-root-url: ..
date: 2023-04-14 21:50:02
index_img: /img/胡桃.jpg
category:
- 数据可视化
---
温州交通数据分析【d3.js】
<!--more-->
### 截图
![](/img/数据可视化/1.png)

### 代码附录

```html
<!DOCTYPE html>
<html>

<head>
    <title>wenzhou_trafficData</title>
    <script src="/static/js/d3.min.js"></script>
</head>

<body style="text-align: center">
    <svg width="1850" height="920" id="mainsvg" class="svgs" style="background-color: #ffffff;"></svg>
    <script>       
        const svg = d3.select('#mainsvg');
        const width = +svg.attr('width');
        const height = +svg.attr('height');
        const margin = { top: 50, right: 60, bottom: 50, left: 60 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const xValue = d => { return +(d['car_flow_out']) };
        const yValue = d => { return +(d['car_flow_in']) };
        const rValue = d => { return Math.sqrt(d['car_flow_out'] * d['car_flow_in']) / 2 };
        const keyHint = 'road_id';
        let xScale, yScale;
        let maxX, maxY;
        let dates;
        let aduration = 100;
        let metapop;

        const xAxisLabel = 'car_flow_out';
        const yAxisLabel = 'car_flow_in';

        var color = ['#BD1A95', '#B5B7E7', '#F5C7B4', '#6281E2', '#B5B908', '#A69C4C', '#52B658', '#E1BEC5', '#14E577', '#4EEEAD', '#93B425', '#B3F1D8', '#CCCCB7', '#2D1F5B', '#C10B52', '#245A35', '#001255', '#FD2125', '#FE26C5', '#9614D5', '#F3374B', '#0D448F', '#560A86', '#1C1A17', '#EA7630', '#50F516', '#DD31D7', '#F355ED', '#2B1D7D', '#329D67', '#6EC78F', '#D5F4AA', '#618291', '#BC5CFC', '#064631', '#25096D', '#2177CE', '#FE49DE', '#1BCB01', '#C29B4A', '#1D2BE9', '#EE0C23', '#5BCAE1', '#C1A6FE', '#FA515A', '#609922', '#0F13CE', '#4D0204', '#8CCED6', '#B518CD', '#CB4E30', '#2FD1AE', '#766E32', '#F32BF1', '#A99214', '#157DD3', '#8E19B9', '#94385D', '#599519', '#A3B05E', '#0F014D', '#FF7B00', '#EAED3D', '#B14092', '#D0E2A2', '#FFB91A', '#842C7F', '#95C5B5', '#201AC2', '#6F640C', '#163619', '#42E7AD', '#61E65F', '#AA5A1B', '#F5086A', '#E9DFA5', '#09B615', '#13D084', '#78DAC7', '#82DBA5', '#A3280B', '#313CE5', '#02B453', '#FBC703', '#1DDA12', '#16B405', '#DC8E89', '#16D4FF', '#C44668', '#AE4DA2', '#88234B', '#D8B07D', '#388BCC', '#9D6B6C', '#45CAD9', '#3308F2', '#F3448F', '#A8D427', '#D63970', '#485B6D', '#CE9093', '#CCE95D', '#E4471A', '#C6953B', '#2767C0', '#3B65E2', '#F85E90', '#E33CFB', '#26F6E2', '#F190C4', '#316B81', '#DEDE34', '#D9A06C', '#FE49EC', '#95BBDE', '#152F55', '#F2DA80', '#7CC878', '#D89D13', '#47E97A', '#DBB1E6', '#3F1717', '#351C0A', '#55DE34', '#B54E47', '#9377FE', '#8C747D', '#BB8E0E', '#3947F6', '#939E6F', '#5BC8D2', '#0CF24A', '#DB89C8', '#43FF04', '#3D9C46', '#E7A4F4', '#8AABDB', '#1F7AC0', '#48BF2B', '#57A2FC', '#5B4B9F', '#7234FE', '#AE2A27', '#AC5BCD', '#4ED986', '#0E0059', '#4AC2DA', '#8CB038', '#57A5A8', '#FABF24', '#451F15', '#74BF20', '#B6A969', '#BF243C', '#971C87', '#127693', '#B2EC40', '#B3B521', '#ED657A', '#6BEA10', '#247EDA', '#005DD4', '#B3EF08', '#8CE26F', '#5047D0', '#513A3C', '#20A62D', '#363711', '#211E8A', '#059057', '#66A09C', '#5C9088', '#81CFE1', '#BB0D76', '#086F64', '#7D9AFC', '#825297', '#4A590B', '#16FEB0', '#D6A1D4', '#208667', '#82EC52', '#866546', '#8A5A3D', '#D355FE', '#0AE41D', '#A01D9B', '#E17424', '#F6D1CC', '#5F9EA8', '#CDECEC', '#55A402', '#5C9CD3', '#ADA79D', '#CEE614', '#C70A82', '#AA3937', '#D85AFB', '#6DC8B7', '#333739', '#828161', '#107893', '#A927BF', '#3B42CB', '#374E53', '#B6AF88', '#19AF1A', '#7297B1', '#1C8131', '#1A6AB6', '#380520', '#4087E5', '#8E3C86', '#0AC3FF', '#4DE507', '#49F612', '#AA81F1', '#52A127', '#E77D16', '#BD817F', '#29F831', '#7B7F13', '#B6E491', '#A434CA', '#B7AADB', '#8E078B', '#9C46CF', '#CD79EE', '#AFAF85', '#3CA0B2', '#8B538F', '#76E3FE', '#2D7F22', '#B4D9D9', '#26761B', '#B0BD05', '#710944', '#D6C0EB', '#923FF7', '#BBEC8F', '#FF46A5', '#821DDF', '#6C7DC8', '#BE0A8C', '#47A8C6', '#B3CDD3', '#B3F389', '#EB996B', '#0A4C12', '#B7E6BE', '#72E14B', '#105F1E', '#974B63', '#2A630F', '#B31C84', '#169DC7', '#25F3E6', '#DB80C5', '#0AC894', '#C38CAF', '#21B475', '#27A98E', '#A51804', '#B27814', '#47CDA5', '#E4DDC8', '#A7DFCD', '#820AEC', '#4DCC6D', '#A1008B', '#F722CE', '#99532A', '#0609E3', '#B1ABF8', '#1F5DF0', '#A96441', '#A68AA2', '#B6419E', '#4B935F', '#32DB5A', '#1EAC74', '#AD5980', '#080D88', '#C5A737', '#720525', '#56E725', '#97D79C', '#F834F1', '#0EBFF6', '#AA6589', '#6CABAD', '#00713A', '#03B804', '#6C56B4', '#4AFE96', '#2CD508', '#7070B6', '#83BD54', '#18C47C', '#31EAFA', '#295DBE', '#DBA93E', '#D9B7A6', '#582145', '#C8077A', '#EBAA47', '#52C4BC', '#48B9A1', '#4F4E62', '#0174D9', '#A560D3', '#9D9894', '#E29745', '#DBBB02', '#2A2B83', '#4A39B5', '#A6BFD9', '#4EED5C', '#CA71F1', '#FE052F', '#EA2C54', '#CB9130', '#87E079', '#CD8FF6', '#BB24B3', '#4BD073', '#6F2BFD', '#8FCE7C', '#FAAACA', '#883CF7', '#B963E7', '#E5FB72', '#9560E5', '#EDC5F0', '#06DD58', '#E9364C', '#9563C8', '#4F4B70', '#EF0207', '#46EDAD', '#2010E6', '#90908D', '#3CF311', '#3B5AF0', '#6B0D72', '#382E40', '#9D6B86', '#4D17D0', '#08DD20', '#F2F81C', '#3EDEFE', '#3D28CE', '#F62C46', '#0F3696', '#F75578', '#A0215F', '#2F9587', '#35D2BF', '#6DD11C', '#D49FE2', '#284D64', '#8FA764', '#CC28F5', '#CAB919', '#97C9F6', '#B45AA5', '#F2B5C2', '#6A9167', '#2FCD9E', '#01273D', '#17F93B', '#14B487', '#800AC4', '#A67FD4', '#2BFEF7', '#7D94FC', '#628E36', '#C1B8D8', '#C415CE', '#CFBCF1', '#AEE21A', '#B30FBC', '#7DFCFA', '#36F7A4', '#88BEFC', '#5FA957', '#F4A5D3', '#7CE6F9', '#C5042C', '#292D0A', '#C4E52A', '#75544A', '#9F3D2B', '#F23F54', '#B9B4D6', '#B3ABF3', '#A2C62B', '#C736F8', '#AE8E7E', '#3CFD57', '#7905F4', '#F3CCC6', '#C406E4', '#49D6DB', '#EF2EB7', '#5DA1B6', '#C4F295', '#76728C', '#C29CA5', '#C21DAB', '#F5FF23', '#1737E5', '#EF9FE2', '#4552A0', '#EA4F1E', '#204E8C', '#6F320D', '#858A12', '#8024DB', '#C6CC00', '#4497F7', '#CADDF5', '#05B56E', '#2F2ADA', '#93F16C', '#9F059B', '#321916', '#F11BB0', '#C63998', '#C05A7B', '#84EF12', '#CFF053', '#BB938B', '#1D2D65', '#0ED910', '#681CC7', '#EA4834', '#68A7B3', '#B0837E', '#BF889E', '#8F2746', '#3BBE4B', '#38D5BA', '#171635', '#54D617', '#28B590', '#52ED25', '#C98B02', '#3B3442', '#EB63B3', '#0FC324', '#2367BE', '#D5E376', '#2D7CBA', '#E56085', '#16E5CA', '#14CC25', '#A16504', '#9D4530', '#C628C8', '#21C9C4', '#D97E9A', '#D0A2E8', '#9C990B', '#1B5637', '#EF44E3', '#136072', '#F40AF1', '#3F08D9', '#58A6BE', '#BE6808', '#E378AE', '#ABC664', '#DE1624', '#E5F92F', '#588C77', '#522811', '#57C2C1', '#6F9F4E', '#9DDF23', '#7DBF79', '#759CC5', '#1B8FF8', '#575F64', '#711B40', '#598F1D', '#DA1C3C', '#84BBAF', '#A3B069', '#952578', '#EC2D25', '#EB5D15', '#D4068C', '#805052', '#F7C9CF', '#5357B5', '#F4C3E6', '#C89933', '#384681', '#8D4F3F', '#55AE07', '#6F1F01', '#739E5A', '#7B4F19', '#ED942C', '#A014A0', '#638A7D', '#16E18C', '#6515E0', '#55940E', '#2D2A2C', '#9B8A28', '#63FC8D', '#1FC296', '#86421C', '#C3A1C8', '#1FDF89', '#A1388D', '#CC8F55', '#7D7923', '#D0E7AF', '#7BCFE0', '#46D778', '#17210A', '#0E7BDD', '#561EAF', '#20BCD4', '#7512B1', '#4BA67C', '#A82588', '#37BB9B', '#C3561D', '#B81F6C', '#8E4600', '#A848F6', '#B75B87', '#C3AB5F', '#2AF8D7', '#2A671B', '#E8C7CF', '#BE9711', '#ABE8EB', '#9478DB', '#18E2D7', '#1EF037', '#30D4DC', '#F210DA', '#9F184B', '#5ED657', '#FDC5FD', '#BEF802', '#E81EC4', '#63B1DB', '#250486', '#62BDE0', '#778789', '#9CB1FE', '#C4CC86', '#BA2067', '#86ADDD', '#8771CF', '#AF8021', '#1CE234', '#66D14F', '#CF9DE9', '#51B8E1', '#DBBC9D', '#33775C', '#83EEC2', '#B77BC8', '#CA8D49', '#25D264', '#55BA03', '#1D7A64', '#1C0FB4', '#67F20B', '#34E5E3', '#D16394', '#FC25DF', '#5E6CED', '#D82659', '#9FBD10', '#8DDA3A', '#79E79C', '#E153C1', '#EAA990', '#649E6E', '#101941', '#0895DB', '#AE7D8D', '#607046', '#BAF405', '#B457A2', '#80F23A', '#6059FC', '#696CB9', '#C947E0', '#189D02', '#DDB749', '#D00F49', '#2F58D8', '#B7AA2B', '#428816', '#D33335', '#AAA469', '#43A12B', '#6B4C88', '#D31BC4', '#96DAEB', '#033117', '#4000AA', '#BA6DA1', '#C78623', '#9E468D', '#A601C2', '#0E27AE', '#9E5BC9', '#35BA89', '#5E6F24', '#E7B799', '#4454F4', '#4A8D51', '#2E35F4', '#EEEC60', '#94BFEE', '#9E3959', '#7B9A15', '#4F7F1A', '#805237', '#0D6689', '#286A47', '#CDD0B6', '#E10535', '#2AC612', '#85E54B', '#5EA572', '#8A019E', '#B8FF81', '#E35532', '#5E265F', '#C3C20A', '#D06BEB', '#6D0CC9', '#D260C2', '#1243D9', '#777A2E', '#681CBE', '#7BC3B6', '#D59930', '#4CC7D6', '#D2BA4B', '#2BD4BC', '#D5E92B', '#40D55D', '#667684', '#767F75', '#B1FCFC', '#0D9F5A', '#FE8933', '#8362C7', '#EBF95D', '#69989C', '#4926ED', '#0243CB', '#EF050A', '#6228A3', '#22AE2F', '#62DA89', '#74D9B9', '#44B491', '#629484', '#49FD41', '#84CB68', '#5DB3E9', '#D03FE0', '#425E00', '#F37454', '#5497A1', '#C54C6F',
        ];

        const renderinit = function (data, seq) {
            xScale = d3.scaleLinear()
                .domain(d3.extent(data, xValue)) // "extent" is equivalent to [d3.min(data, xValue), d3.max(data, xValue)]; 
                .range([0, innerWidth])
                .nice();

            // Introducing y-Scale; 
            yScale = d3.scaleLinear()
                .domain(d3.extent(data, yValue).reverse()) // remember to use reverse() to make y-axis start from the bottom; 
                .range([0, innerHeight])
                .nice();

            // generate maxX and maxY; 
            maxX = xScale(d3.max(data, xValue));
            maxY = yScale(d3.max(data, yValue));

            // The reason of using group is that nothing is rendered outside svg, so margin of svg is always blank while margin of group is rendered inside svg; 
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left}, ${margin.top})`)
                .attr('id', 'maingroup');

            // Adding axes; 
            const yAxis = d3.axisLeft(yScale)
                .tickSize(-innerWidth)
                //.tickFormat(d3.format('.2s'))
                .tickPadding(10); // .tickPadding is used to prevend intersection of ticks; 
            const xAxis = d3.axisBottom(xScale)
                //.tickFormat(d3.format('.2s'))
                .tickSize(-innerHeight)
                .tickPadding(10);

            let yAxisGroup = g.append('g').call(yAxis)
                .attr('id', 'yaxis');
            yAxisGroup.append('text')
                .attr('font-size', '2em')
                .attr('transform', `rotate(-90)`)
                .attr('x', -innerHeight / 2)
                .attr('y', -30)
                .attr('fill', '#333333')
                .text(yAxisLabel)
                .attr('text-anchor', 'middle') // Make label at the middle of axis. 
            yAxisGroup.selectAll('.domain').remove(); // we can select multiple tags using comma to seperate them and we can use space to signify nesting; 

            let xAxisGroup = g.append('g').call(xAxis)
                .attr('transform', `translate(${0}, ${innerHeight})`)
                .attr('id', 'xaxis');
            xAxisGroup.append('text')
                .attr('font-size', '2em')
                .attr('y', 30)
                .attr('x', innerWidth / 2)
                .attr('fill', '#333333')
                .text(xAxisLabel);
            xAxisGroup.selectAll('.domain').remove();
        };

        const renderupdate = function (seq, datestr) {
            const g = d3.select('#maingroup');
            time = seq[0]['time_minute'];
            g.selectAll('.date_text').remove();
            g.append("text")
                .data(['seq'])
                .attr('class', 'date_text')
                .attr("x", innerWidth / 4 + 50)
                .attr("y", innerHeight / 10)
                .attr("dy", ".5em")
                .style("text-anchor", "end")
                .attr("fill", "#504f4f")
                .attr('font-size', '4em')
                .attr('font-weight', 'bold')
                .text(datestr + ' ' + time);

            circleupdates = g.selectAll('circle').data(seq, d => d[keyHint]);
            circleenter = circleupdates.enter().append('circle')
                .attr('cy', (datum) => { return yScale(yValue(datum)) })
                .attr('cx', (datum) => { return xScale(xValue(datum)) }) // use xSacle to re-scale data space (domain) and return the rescaled population; 
                .attr('r', datum => rValue(datum))
                .attr('fill', function (d, i) { return color[d[keyHint]] })
                .attr('opacity', .8);
            circleupdates.merge(circleenter).transition().ease(d3.easeLinear).duration(aduration)
                .attr('cy', (datum) => { return yScale(yValue(datum)) })
                .attr('cx', (datum) => { return xScale(xValue(datum)) }) // use xSacle to re-scale data space (domain) and return the rescaled population; 
                .attr('r', datum => rValue(datum));

            textupdates = g.selectAll('.province_text').data(seq);
            textenter = textupdates.enter().append('text')
                .attr("class", "province_text")
                .attr("x", (datum) => { return xScale(xValue(datum)); })
                .attr("y", (datum) => { return yScale(yValue(datum)); })
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .attr("fill", "#333333")
                //.attr('opacity', 0)
                .text(function (d, i) {
                    return d[keyHint];
                });

            textupdates.merge(textenter).transition().ease(d3.easeLinear).duration(aduration)
                .attr('x', (datum) => {
                    return xScale(xValue(datum));
                })
                .attr('y', (datum) => { return yScale(yValue(datum)); });
        };



        var data1 = d3.csv('./static/data/five_carflow20140101.csv');
        var data2 = d3.csv('./static/data/five_carflow20140102.csv');
        var data3 = d3.csv('./static/data/five_carflow20140103.csv');
        var data4 = d3.csv('./static/data/five_carflow20140104.csv');
        var data5 = d3.csv('./static/data/five_carflow20140105.csv');
        var data6 = d3.csv('./static/data/five_carflow20140106.csv');
        var data7 = d3.csv('./static/data/five_carflow20140107.csv');
        var data8 = d3.csv('./static/data/five_carflow20140108.csv');
        var data9 = d3.csv('./static/data/five_carflow20140109.csv');
        var data10 = d3.csv('./static/data/five_carflow20140110.csv');
        var data11 = d3.csv('./static/data/five_carflow20140111.csv');
        var data12 = d3.csv('./static/data/five_carflow20140112.csv');
        var data13 = d3.csv('./static/data/five_carflow20140113.csv');
        var data14 = d3.csv('./static/data/five_carflow20140114.csv');
        var data15 = d3.csv('./static/data/five_carflow20140115.csv');
        var sequential = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []];



        let len;
        data1.then(function (data) {
            data.forEach(datum => {
                datum['road_id'] = +(datum['road_id']);
                datum['car_flow_out'] = +(datum['car_flow_out']);
                datum['car_flow_in'] = +(datum['car_flow_in']);
                datum['time_minute'] = +(datum['time_minute']);

            });

            alldates = Array.from(new Set(data.map(datum => datum['time_minute'])));
            alldates = alldates.sort(function (a, b) {
                return a - b;
            });

            dates = alldates;
            alldates.forEach(datum => {
                sequential[1].push([]);
            });
            data.forEach(datum => {
                sequential[1][alldates.indexOf(datum['time_minute'])].push(datum);
            });
            len = alldates.length;
            renderinit(data, sequential[1][0]);
        });

        const data_process = function (d, i) {
            d.then(function (data) {
                data.forEach(datum => {
                    datum['road_id'] = +(datum['road_id']);
                    datum['car_flow_out'] = +(datum['car_flow_out']);
                    datum['car_flow_in'] = +(datum['car_flow_in']);
                    datum['time_minute'] = +(datum['time_minute']);
                });

                var alldates = Array.from(new Set(data.map(datum => datum['time_minute'])));
                alldates = alldates.sort(function (a, b) {
                    return a - b;
                });

                var dates = alldates;
                alldates.forEach(datum => {
                    sequential[i].push([]);
                });
                data.forEach(datum => {
                    sequential[i][alldates.indexOf(datum['time_minute'])].push(datum);
                });

            });
        };

        data_process(data2, 2);
        data_process(data3, 3);
        data_process(data4, 4);
        data_process(data5, 5);
        data_process(data6, 6);
        data_process(data7, 7);
        data_process(data8, 8);
        data_process(data9, 9);
        data_process(data10, 10);
        data_process(data11, 11);
        data_process(data12, 12);
        data_process(data13, 13);
        data_process(data14, 14);
        data_process(data15, 15);

        let c = 0;
        let m = 1;
        var intervalId1 = setInterval(function () {
            if (c >= len) {
                m = m + 1;
                c = 0;
            } else if (m <16) {
                renderupdate(sequential[m][c], '第'+m+'天');
                c = c + 1;
            }
            else {
                clearInterval();
            }
        }, aduration);


    </script>
</body>

</html>
```


<p class="note note-success">author: YaoGuangMing 2023-HDU</p>
<p class="note note-warning">转载请标明出处！</p>